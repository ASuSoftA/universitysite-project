<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#2c3e50">

    <title>Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ - Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  overflow: hidden;
  font-family: system-ui, sans-serif;
}

.chat-app {
  position: fixed;
  inset: 0;
  display: flex;
  flex-direction: column;
  background: #fff;
}

/* Header Ø«Ø§Ø¨Øª */
.chat-header {
  height: 56px;
  flex-shrink: 0;
  background: linear-gradient(135deg, #2c3e50, #3498db);
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
}

        .back-button {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: white;
            text-decoration: none;
            font-size: 22px;
            background-color: rgba(255, 255, 255, 0.2);
            padding: 8px;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            background-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-50%) scale(1.1);
        }

/* Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ÙÙ‚Ø· ØªØªØ­Ø±Ùƒ */
.chat-messages {
  flex: 1;
  overflow-y: auto;
  padding: 12px;
  background: #f5f5f5;
  direction: ltr; /* ğŸ”¥ Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ù…ÙØªØ§Ø­ */
}

/* Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ */
.message {
  max-width: 80%;
  padding: 10px 14px;
  margin-bottom: 8px;
  border-radius: 16px;
  direction: rtl; /* Ø§Ù„Ù†Øµ Ø¹Ø±Ø¨ÙŠ */
  text-align: right;
}

.user-message {
  background: #3498db;
  color: white;
  align-self: flex-end;
  border-bottom-right-radius: 4px;
}

.bot-message {
  background: #eaeaea;
  color: #333;
  align-self: flex-start;
  border-bottom-left-radius: 4px;
}

/* Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø«Ø§Ø¨Øª */
.chat-input-container {
  height: 56px;
  flex-shrink: 0;
  display: flex;
  gap: 8px;
  padding: 8px;
  border-top: 1px solid #ddd;
  background: white;
}

.chat-input-container input {
  flex: 1;
  border-radius: 20px;
  border: 1px solid #ccc;
  padding: 10px;
  outline: none;
}

.chat-input-container button {
  width: 44px;
  border-radius: 50%;
  border: none;
  background: #3498db;
  color: white;
  font-size: 18px;
}

    </style>
</head>

<body>
<div class="chat-app" id="chatApp">

  <div class="chat-header">
    <h2 style="margin:0;font-size:20px;">Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ Ù„Ù„Ø¬Ø§Ù…Ø¹Ø©</h2>
    <a href="{{ url_for('main.index') }}" class="back-button" title="Ø§Ù„Ø¹ÙˆØ¯Ø©">
      <i class="fas fa-home"></i>
    </a>
  </div>


  <div class="chat-messages" id="chatMessages">
    <div class="message bot-message">
      Ù…Ø±Ø­Ø¨Ù‹Ø§! ğŸ‘‹ Ø£Ù†Ø§ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ Ù„Ù„Ø¬Ø§Ù…Ø¹Ø©. ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ØŸ
    </div>
  </div>

  <div class="chat-input-container">
    <input
      type="text"
      id="userInput"
      placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..."
      autocomplete="off"
    >
    <button id="sendBtn">â¤</button>
  </div>

</div>


<script>
const app = document.getElementById('chatApp');
const messages = document.getElementById('chatMessages');
const input = document.getElementById('userInput');
const sendBtn = document.getElementById('sendBtn');

/* ØªØ«Ø¨ÙŠØª Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ Ø¹Ù†Ø¯ Ø¸Ù‡ÙˆØ± Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­ */
function resizeApp() {
  if (window.visualViewport) {
    app.style.height = window.visualViewport.height + 'px';
  }
}
window.visualViewport?.addEventListener('resize', resizeApp);
window.addEventListener('load', resizeApp);

/* ØªÙ…Ø±ÙŠØ± Ù„Ø£Ø³ÙÙ„ */
function scrollToBottom() {
  messages.scrollTop = messages.scrollHeight;
}

/* Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© */
function addMessage(text, isUser = false) {
  const div = document.createElement('div');
  div.className = 'message ' + (isUser ? 'user-message' : 'bot-message');
  div.innerHTML = text;
  messages.appendChild(div);
  scrollToBottom();
}

/* Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© */
function sendMessage() {
  const msg = input.value.trim();
  if (!msg) return;

  addMessage(msg, true);
  input.value = '';
  input.focus();

  // Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø©
  const typing = document.createElement('div');
  typing.className = 'message bot-message';
  typing.id = 'typing';
  typing.innerHTML = 'â³ <em>ÙŠÙƒØªØ¨...</em>';
  messages.appendChild(typing);
  scrollToBottom();

  fetch('/api/chat', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ message: msg })
  })
  .then(res => res.json())
  .then(data => {
    const t = document.getElementById('typing');
    if (t) t.remove();
    addMessage(data.response || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø®Ø§Ø¯Ù…');
  })
  .catch(() => {
    const t = document.getElementById('typing');
    if (t) t.remove();
    addMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„');
  });
}

/* Ø§Ù„Ø£Ø­Ø¯Ø§Ø« */
sendBtn.addEventListener('click', sendMessage);
input.addEventListener('keydown', e => {
  if (e.key === 'Enter') sendMessage();
});

/* Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
window.addEventListener('load', () => {
  scrollToBottom();
  input.focus();
});
</script>

</body>
</html>
