{% extends "base.html" %}

{% block title %}إضافة منشور جديد - لوحة التحكم{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h4>إضافة منشور جديد</h4>
                <small class="text-muted">جميع الحقول اختيارية - أضف محتوى واحد على الأقل</small>
            </div>

            <div class="card-body">
                <form method="POST"
                      action="{{ url_for('admin_control.new_post') }}"
                      enctype="multipart/form-data">

                    <!-- ===== حقل الكلية ===== -->
                    {% if current_user.is_super_admin %}
                    <div class="mb-3">
                        <label class="form-label">الكلية</label>
                        <select name="faculty_id" class="form-select" required>
                            <option value="">اختر الكلية</option>
                            {% for f in faculties %}
                                <option value="{{ f.id }}">{{ f.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    {% else %}
                        <input type="hidden" name="faculty_id" value="">
                        <div class="mb-3">
                            <label class="form-label">الكلية</label>
                            <input type="text" class="form-control" value="{{ current_user.faculty.name }}" readonly>

                        </div>
                    {% endif %}

                    <div class="mb-3">
                        <label class="form-label">عنوان المنشور</label>
                        <input type="text" class="form-control" name="title">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">المحتوى</label>
                        <textarea class="form-control" name="content" rows="5"></textarea>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">نوع المحتوى</label>
                        <select class="form-select" id="post_type" name="post_type">
                            <option value="text">نص</option>
                            <option value="image">صورة</option>
                            <option value="video">فيديو</option>
                        </select>
                    </div>

                    <div class="mb-3" id="image-field">
                        <label class="form-label">صورة</label>
                        <input type="file" class="form-control" name="image" accept="image/*">
                    </div>

                    <div class="mb-3" id="video-field" style="display:none;">
                        <label class="form-label">فيديو</label>
                        <input type="file" class="form-control" name="video" accept="video/*">
                    </div>

                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox"
                               name="is_published" checked>
                        <label class="form-check-label">نشر فوري</label>
                    </div>

                    <button type="submit" class="btn btn-primary">إضافة المنشور</button>
                    <a href="{{ url_for('admin_control.dashboard') }}"
                       class="btn btn-secondary">إلغاء</a>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('post_type').addEventListener('change', function () {
    document.getElementById('image-field').style.display =
        this.value === 'image' ? 'block' : 'none';

    document.getElementById('video-field').style.display =
        this.value === 'video' ? 'block' : 'none';
});
</script>
{% endblock %}
